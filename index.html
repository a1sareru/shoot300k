<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="あなたと友人になれたら♪" />
  <meta name="author" content="とある名無し賢者" />
  <title>shoot300k</title>
  <!-- favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="static/favicon-16x16.png">
  <link rel="shortcut icon" href="static/favicon.ico">
  <link rel="manifest" href="site.webmanifest">
  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- 固定顶部的导航栏 -->
  <nav class="navbar">
    <a class="nav-item" data-target="topPage" data-i18n="top.nav-topPage">✨ 首页</a>
    <a class="nav-item" data-target="selectCards" data-i18n="top.nav-selectCards">🎴 持有卡牌</a>
    <a class="nav-item" data-target="calc" data-i18n="top.nav-calc">🧮 卡组计算</a>
    <a class="nav-item" data-target="prophecy" data-i18n="top.nav-prophecy">📜 予言書(仮)</a>
    <a class="nav-item" data-target="about" data-i18n="top.nav-about">🤫 关于</a>
    <a class="nav-item" id="toggle-theme">☀️/🌙</a>
  </nav>

  <!-- 各个页面 -->
  <div class="container">
    <!-- Top -->
    <div id="topPage" class="tab-content">
      <p id="repo-last-updated" style="text-align: right;" class="komejirushi-text"></p>
      <div style="font-size: 0.8em; text-align: center;color:#cc8eb5;">
        ✨左上のフラグアイコンをクリックすると言語を切り替えられます。現在対応している言語：中国語（簡体字）、日本語。✨<br>✨点击左上角的旗帜小图标可切换语言。当前支持：简体中文、日文。✨
      </div>
      <hr>
      <div data-i18n="top.top-info">
      </div>
      <h2 data-i18n="top.h2-usage"></h2>
      <p></p>
      <ul data-i18n="top.h2-usage-content"></ul>
      </p>
      <br>
      <p data-i18n="top.card-annotation-note">
      </p>
      <h2 data-i18n="top.h2-caution"></h2>
      <div data-i18n="top.h2-caution-content"></div>
      <div data-i18n="top.content-below-may-not-translated"></div>
      <h2>📣 记事</h2>
      <p><span style="font-weight: 900;">[2025-08-08]</span><br>
      Fix a bug mentioned by a korean user on X, which caused the card selection to not work properly when the card ID is greater than 337. Thank you very much!
      </p>
      <p><span style="font-weight: 900;">[2025-08-08]</span><br>
        <a class='my-links' href='https://gamerch.com/wizard-promise' target='_blank' rel='noopener noreferrer'>『魔法使いの約束 攻略Wiki（Gamerch）』</a>の管理人様に、Xにて当サイトをご紹介いただき、誠にありがとうございます。今後ともよろしくお願いいたします。<br>
        感谢<a class='my-links' href='https://gamerch.com/wizard-promise' target='_blank' rel='noopener noreferrer'>『魔法使いの約束 攻略Wiki（Gamerch）』</a>的管理人在 X 上介绍了本站点，今后也请多多关照。
      </p>
      <p><span style="font-weight: 900;">[2025-08-06]</span><br>
        全站点i18n支持已完成，当前支持中文/日文。
      </p>
      <p><span style="font-weight: 900;">[2025-08-05]</span><br>
        为非功能部分添加了i18n支持。
      </p>
      <p><span style="font-weight: 900;">[2025-08-04]</span><br>
        卡牌图片更换为辨识度更佳的 icon 版。<br>
        选卡界面改为即点即显示。
      </p>
      <p><span style="font-weight: 900;">[2025-07-21]</span><br>
        数据更新频率从月更改为不定期更新。
      </p>
      <p><span style="font-weight: 900;">[2025-06-30]</span><br>
        为结果卡组增加了筛选颜色的功能。
      </p>
      <p><span style="font-weight: 900;">[2025-06-21]</span><br>
        听取热心贤者酱的建议，将持有卡牌的库存页面改为倒序展示，以便添加新库存。
      </p>
      <p><span style="font-weight: 900;">[2025-05-19]</span><br>
        优化了生日卡牌的时间标注方式 <del>考虑到生日卡是从12月开始轮的</del>；<br>
        <del>其他定时限定卡牌的标注也顺便都加上了</del><br>
        优化了选卡界面的显示，现在可以通过点击「卡牌标题」跳转到 bwiki 的对应界面。
      </p>
      <p><span style="font-weight: 900;">[2025-04-28]</span><br>
        增加了2024瓦夜活动卡牌的标注。感谢指出问题的贤者 🙌
      </p>
      <p><span style="font-weight: 900;">[2025-04-24]</span><br>
        已初步支持昼夜主题切换，虽然还有很多细节要修<br>
        <del>比如说现在代码里的配色设置已经乱成了一锅粥</del><br>
        <del>虽然说目前除了开发者以外 0 人对此有意见</del><br>
        鉴于开发者相当缺乏美术素养，UI/配色等方面的建议大欢迎:)
      </p>
      <p><span style="font-weight: 900;">[2025-04-20]</span><br>
        修正了部分卡牌的数据缺失问题。<br>
        最近在考虑要不要做个昼夜主题支持……（画饼中）
      </p>
      <p><span style="font-weight: 900;">[2025-04-04]</span><br>
        修改了数据加载的方式，应该可以减少「能够加载卡牌、但无法进行计算」的情形。<br>
        但由于各地网络服务提供商等差异，仍无法保证 100% 消除该问题。<br>
        必要时仍然请考虑使用魔法上网🪄
      </p>
      <p><span style="font-weight: 900;">[2025-04-03]</span><br>
        Update the favicon for the website.<br>
        Attribution:
        <a href="https://www.flaticon.com/free-icons/magic" class="my-links" title="magic icons">
          Magic icons created by Freepik - Flaticon
        </a>
      </p>
      <p><span style="font-weight: 900;">[2025-03-27]</span><br>
        在计算页面增加了「必要时使用魔法上网🪄」的提示。<br>
        依据官方使用的キャンペーン名，修改了部分内容的表述。
      </p>
      <p><span style="font-weight: 900;">[2025-02-28]</span><br>
        收到了热心贤者酱的报错邮件，据此排查并修复了计算逻辑。感谢反馈！🙇‍♀️ <br>
        本次修复后库存牌组解大量增加，之前计算结果为空的贤者酱可以再试试看～
      </p>
      <p><span style="font-weight: 900;">[2025-02-22]</span><br>
        对于恒常卡牌及部分特殊限定卡牌，目前两个结果页面均增加了标注。<br>
        对于2024-04之后实装的卡牌，其所属活动/卡池类型数据由开发者人工添加，如发现问题，欢迎联系开发者 🙇‍♀️
      </p>
      <p><span style="font-weight: 900;">[2025-02-17]</span><br>
        <!-- <div class="plain-container"> -->
        <!-- <div class="plain-image">
          <img src="public/images/miscs/happyKitten.gif" alt="happy猫" />
        </div> -->
        <!-- <div class="plain-text"> -->
        结果去重已完成，同时还优化了「予言書(仮)」的计算逻辑。<br>
        或许又能多显示一些原本被错误地过滤掉的结果了（？）
        <!-- </div> -->
        <!-- </div> -->
      </p>
      <p><span style="font-weight: 900;">[2025-02-16]</span><br>
        <!-- <div class="plain-container"> -->
        <!-- <div class="plain-image">
          <img src="public/images/miscs/cryingKitten.gif" alt="猫抱头痛哭" />
        </div> -->
        <!-- <div class="plain-text"> -->
        准备做结果去重优化的时候意外发现了一些小错误……目前已经修完了！<br>
        大致推了一下，受到这些 bug 影响的应该主要是「予言書(仮)」的结果，之前在该页面没有获得相关结果的贤者酱可以再试试看了🙇‍♀️<br>
        <del>所以结果去重的优化就下次再做吧（闭目）</del>
        <!-- </div> -->
        <!-- </div> -->
      </p>
      <p><span style="font-weight: 900;">[2025-02-11]</span><br>
        感谢微博 <a class="my-links" href="https://weibo.com/u/7917052807">@魔法使的约定情报站</a>
        在接收投稿的同时还附上了详细介绍！皮下辛苦了！<br>
        又：<del>在群里看到不是开发者一个人对着贫瘠的卡牌库存破防，于是</del>
        初步完成了「予言書(仮)」页面，现在可以计算还差 1-2 张卡就能达成的卡组了。<br>
        总之希望能帮上忙🫶 给大家点一首「あなたと友人になれたら」♪（何
      </p>
      <p><span style="font-weight: 900;">[2025-02-09]</span><br>
        <del>初步完成后拿自己的库存做测试数据，发现厨房活动抽到的 Nero 竟然贡献了唯一解，破防；于是</del>
        正在考虑「复刻卡池规划建议」这个功能该怎么做……
        <br>牌组的归并优化做得并不充分，但总之凑合能用；如果之后把现在使用的简易算法说明贴上来的话，会得到优化建议吗（……）
      </p>

      <h2>🧭 站点导航</h2>
      <del>为什么这一节反而放在最后呢？因为确实不太重要呢……</del>
      <ul>
        <li>「Top」：站点首页。</li>
        <li>「持有卡牌」：选择您所持有的卡牌，生成卡牌库存字符串。</li>
        <li>「卡组计算」：输入卡牌库存字符串，计算符合条件的卡组</li>
        <li>「予言書(仮)」：输入卡牌库存字符串，计算还差 1-2 张卡就能达成的卡组</li>
        <li>「关于」：关于本站点的其他信息。</li>
      </ul>

    </div>


    <!-- 持有卡牌 -->
    <div id="selectCards" class="tab-content" style="margin: 10px;">
      <div class="selectCards-header">
        <div class="submit-result-container">
          <div class="komejirushi-text" data-i18n="cardmanager.description"></div>
          <button id="clear-selection" class="clear-btn" data-i18n="btn.clear"></button>
          <button id="toggle-sr" data-i18n="btn.select-all-sr"></button>
          <button id="filter-ssr" data-i18n="btn.only-show-ssr"></button>
          <br>
          <button id="copy-result" class="copy-btn" data-i18n="btn.copy"></button>
          <div id="selected-ids"></div>
        </div>
      </div>
      <!-- 滚动区域：卡牌列表 -->
      <div class="selectCards-scrollable">
        <div id="card-list">加载中...</div>
      </div>
    </div>


    <!-- 卡组计算 -->
    <div id="calc" class="tab-content">
      <p data-i18n="calc-desc-line1"></p>
      <div class="komejirushi-text">
        <p data-i18n="calc-desc-line2"></p>
        <span data-i18n="calc-desc-line3"></span>
      </div>

      <div>
        <!-- 用户输入框 -->
        <div>
          <textarea class="string-input-area" id="card-input" placeholder="" data-i18n="input.placeholder"
            rows="3"></textarea>
        </div>

        <!-- 提交按钮 -->
        <button id="submit-calc" class="submit-btn" data-i18n="btn.calc"></button>
      </div>

      <!-- 计算错误消息 -->
      <p id="calc-error-invalid-input" class="error-text" style="display: none" data-i18n="calc.error.invalid-input">
      </p>
      <p id="calc-error-load-faliure" class="error-text" style="display: none" data-i18n="calc.error.load-failure"></p>

      <!-- 计算结果区域 -->
      <h2 data-i18n="calc-results-title"></h2>
      <p class="komejirushi-text" data-i18n="magic-net-hint-zh">
      </p>
      <div id="calc-results" class="result-container">
        <p class="result-container-text" data-i18n="calc-results-original-text"></p>
      </div>
    </div>


    <!-- 予言書（仮）-->
    <div id="prophecy" class="tab-content">
      <div class="plain-container">
        <div class="plain-image">
          <img src="public/images/miscs/kanryou.png" alt="予言書：完了" />
        </div>
        <div class="plain-text" data-i18n="prophecy-special-note"></div>
      </div>
      <!-- 分割线 -->
      <hr>
      <br>
      <p data-i18n="calc-desc-line1"></p>
      <div class="komejirushi-text">
        <p data-i18n="prophecy-desc-line2"></p>
        <span data-i18n="calc-desc-line3"></span>
      </div>
      <div>
        <!-- 用户输入框 -->
        <div>
          <textarea class="string-input-area" id="prophecy-card-input" placeholder=""
            data-i18n="input.placeholder"></textarea>
        </div>

        <!-- 提交按钮 -->
        <button id="submit-prophecy-calc" class="submit-btn" data-i18n="btn.prophecy">预言(?)卡组</button>
      </div>

      <!-- 计算错误消息 -->
      <p id="prophecy-calc-error-invalid-input" class="error-text" style="display: none;"
        data-i18n="calc.error.invalid-input"></p>
      <p id="prophecy-calc-error-load-failure" class="error-text" style="display: none;"
        data-i18n="calc.error.load-failure"></p>

      <!-- 计算结果区域 -->
      <h2 data-i18n="calc-results-title"></h2>
      <p class="komejirushi-text" data-i18n="magic-net-hint-zh"></p>
      <div id="prophecy-calc-results" class="result-container">
        <p class="result-container-text" data-i18n="prophcy-results-original-text"></p>
      </div>
    </div>


    <!-- 关于 -->
    <div id="about" class="tab-content">
      <h2>⚖️ Disclaimer</h2>

      <p data-i18n="disclaimer.text"></p>

      <h2>📮 Contact us</h2>
      <span data-i18n="contact-us"></span>

      <div data-i18n="top.content-below-may-not-translated"></div>
      <h2>⚓️ Furthermore</h2>

      <p>本站点将来可能增加的功能：暂无。 <del>欢迎许愿</del></p>

      <h2>💡 Algorithm</h2>

      <p>（更新于 2025-02-28）</p>

      <p><del>顺便解释一下为什么「予言書(仮)」里可能出现重复组合</del></p>

      <h3>🎯 目标描述</h3>

      <p>通过 5 张卡牌凑出 2 种颜色的全部 14 种銀枠特性。</p>

      <h3>🧐 问题的简化</h3>

      <h4>1️⃣ 排除稀有度为 R 和 N 的卡牌</h4>
      <p>目前（2025-02-11） 唯一一张带有 4 个銀枠特性的 SSR 是
      <ul>
        <li>
          <a href="https://wiki.biligame.com/mahoyaku/Card_378" target="_blank" rel="noopener noreferrer">
            <img src="public/images/card_icons/Card_icon_378.png" alt="【水面に揺蕩う想い】スノウ" class="card-img"
              onerror="this.src='https://public/images/miscs/placeholder.png';">
          </a><span style="font-weight: 800;">【水面に揺蕩う想い】スノウ</span> （20年まほパ大雪）
        </li>
      </ul>
      不过它带的是 2白1赤1紫，在不同的场合可以视作一张「白白赤」或一张「白白紫」。</p>
      <p>
        由于 4 张 SSR 最多也只能提供<span style="font-weight: 700;">两种颜色</span>的 12 个銀枠特性，
        因此可知目前不可能有使用 R 卡和 N 卡的 30 万分卡组。
      </p>

      <h4>2️⃣ 考察特殊情况→分析目标卡组的卡牌构成</h4>
      <p>通常情况下，一张 SSR 会带有 2 种颜色共计 3 种銀枠特性（可记为 AAB），一张 SR 会带有 2 种颜色共计 2 种銀枠特性（可记为 AB）。</p>
      <p>除了上面提到的这张魔法趴大雪外， 注意到的特殊情况有：
      <ol>
        <li>西祝祭 SSR 的銀枠被「愛嬌」占据了一个位置，所以等价于普通 SR；</li>
        <li>同理，西祝祭 SR 等价于普通 R，在求解时应当排除；</li>
        <li>以下 3 张 SR 均携带了 2 个颜色共计 3 种銀枠特性，可以视作普通 SSR：
          <ul>
            <li>
              <a href="https://wiki.biligame.com/mahoyaku/Card_177" target="_blank" rel="noopener noreferrer">
                <img src="public/images/card_icons/Card_icon_177.png" alt="【夢のような黄昏】スノウ" class="card-img"
                  onerror="this.src='public/images/miscs/placeholder.png';">
              </a><span style="font-weight: 800;">【夢のような黄昏】スノウ</span> （20年情人节 Snow）
            </li>
            <li>
              </p>
              <a href="https://wiki.biligame.com/mahoyaku/Card_847" target="_blank" rel="noopener noreferrer">
                <img src="public/images/card_icons/Card_icon_847.png" alt="【熱烈な愛を止めるため】ファウスト" class="card-img"
                  onerror="this.src='public/images/miscs/placeholder.png';">
              </a><span style="font-weight: 800;">【熱烈な愛を止めるため】ファウスト</span> （23年情人节 Faust）
            </li>
            <li>
              <a href="https://wiki.biligame.com/mahoyaku/Card_848" target="_blank" rel="noopener noreferrer">
                <img src="public/images/card_icons/Card_icon_848.png" alt="【溢れんばかりのお土産を】シノ" class="card-img"
                  onerror="this.src='public/images/miscs/placeholder.png';">
              </a><span style="font-weight: 800;">【溢れんばかりのお土産を】シノ</span> （23年情人节 Shino）
            </li>
          </ul>
        </li>
      </ol>
      </p>
      <p>可以看出，特殊情况的卡牌，实际上仍然可以当作一般情况来处理<del>（换个名字罢了）</del>。
        为便于讨论，暂时约定下文中「SSR」指「携带了当前讨论的 2 种颜色共计 3 种銀枠特性的卡牌」，
        「SR」指「携带了当前讨论的 2 种颜色共计 2 种銀枠特性的卡牌」。</p>
      <p>回到目标卡组的构成讨论，可以证明：
        <span style="font-weight: 700;">对于一个 AB 双色目标卡组 ，其必然包含至少 2 张 AAX 型 SSR以及至少 2 张 BBX 型 SSR。</span>
        下面给出该引理的简要证明思路：
      </p>
      <ul>
        <li>用 5 张卡凑出 14 个 tag，说明其中至少有 4 张是一般意义上的 SSR（反证法，少于 4 张时最多只能提供 \(3\times 3+2\times 2=13\) 个銀枠特性）；</li>
        <li>再次使用反证法：如果卡组中只有 1 张 AAB 型 SSR，则该卡组最多只能凑出 \(2\times 1+1\times 4=6\)个銀枠特性，这不符合每种颜色要凑齐 7 个銀枠特性的需求（BBA同理）。</li>
      </ul>
      <p>根据引理可知，每个目标卡组的构成有三种可能：
      <ol>
        <li>2 张 AAB 型 SSR，2 张 BBA 型 SSR，1 张 AB 型 SR 或 ABX 型 SSR；</li>
        <li>3 张 AAB 型 SSR，1 张 BBA 型 SSR，1 张 BBX；</li>
        <li>1 张 AAB 型 SSR，3 张 BBA 型 SSR，1 张 AAX。</li>
      </ol>
      </p>

      <h4>3️⃣ 压缩搜索空间→转化为组合方案的枚举问题</h4>
      <p>常规的想法是使用动态规划相关的算法，并根据问题特性进行剪枝等优化。但是根据上面的结论，实际上可以将问题转化为组合方案的枚举问题。</p>
      <p><del>开发者当然不会承认是因为动态规划和引用求解器的方案跑了一天一夜都没结束才开始被迫思考如何避免搜索空间爆炸问题。</del></p>
      <p>既然已经证明了关于卡组构成的以上结论，那么对于指定的两种颜色，任意抽出 2 个銀枠特性，问题便转化为如何找出可凑出两种颜色的剩下各 6 个特性的 4 张卡。</p>
      <p>容易看出，符合条件的 4 张卡一共也只有 12 个銀枠特性，因此可以通过枚举这 4 张卡的组合方案来解决问题。</p>

      <h3>🔍 分解步骤</h3>

      <h4>1️⃣ 进一步抽象问题</h4>
      <p>对于给定的两种颜色 AB，并指定 2 个銀枠特性，求解 4 张 SSR，使之可以提供剩余的全部 12 个銀枠特性</p>

      <h4>2️⃣ 可能 1</h4>
      <p>对于指定的颜色 A，每张 SSR 均携带了 1 或 2 种该色的銀枠特性，则需要将同色的 6 种特性分为 \(\{2,2,1,1\}\) 的组合后，再与另一种颜色组合。</p>
      <p>同色 6 种特性的 \(\{2,2,1,1\}\) 组合，共有
        \[
        \frac{\binom{6}{2} \times \binom{4}{2} \times \binom{2}{1} \times \binom{1}{1}}{\binom{2}{1}\times\binom{1}{1}}
        = 45
        \]
        种可能性；</p>
      <p>两种颜色组合为 4 张卡牌，共有
        \[
        45 \times 45 \times \binom{2}{1} \times \binom{2}{1} = 8100
        \]
        种方案。</p>
      <p>接下去只要对每个可能的组合检查是否有相应的卡牌即可。</p>
      <p>双色的选取共有 \(\binom{5}{2}=10\) 种可能，指定双色的銀枠特性的选取共有\(7\times 7=49\) 种可能，故一共只需要检查
        \[
        8100 \times 10 \times 49 = 3969000
        \]
        种组合方案。</p>
      </p>
      <h4>3️⃣ 可能 2 & 3</h4>
      <p>假设指定了銀枠特性 A1, A2，则需要将剩下的 5 种 A 色特性分为 \(\{1,1,1,2\}\) 的组合，7 种 B 色特性分为 \(\{2,2,2,1\}\) 的组合，
        然后再将两种颜色进行组合，得到卡牌的组合方案。
      </p>
      <p>A 色的 \(\{1,1,1,2\}\) 组合，共有 \(\binom{5}{2} = 10\) 种可能性；</p>
      <p>B 色的 \(\{2,2,2,1\}\) 组合，共有
        \[
        \frac{\binom{7}{1} \times \binom{6}{4} \times \binom{4}{2} \times \binom{2}{2}}{3!} = 105
        \]
        种可能性；</p>
      <p>
        两种颜色组合为 4 张卡牌，共有
        \[
        (10 \times 105) \times (3\times 2) = 6300
        \]
        种方案。
      </p>
      <p>
        双色的选取共有 \(\binom{5}{2}=10\) 种可能，銀枠特性的选取共有 \(\binom{7}{2}\times 2 =42\) 种可能，故一共只需要检查
        \[
        6300 \times 10 \times 42 = 2646000
        \]
        种组合方案。
      </p>

      <h4>4️⃣ 数据结构</h4>
      <p>对于每一对标签，分别存储上述的「1张提供2-标签的卡牌」和「4 张 SSR」，从而构成一系列完整卡组方案。</p>

      <h3>🖥️ 结果呈现</h3>
      <p>接收贤者酱的输入，逐个方案进行比对，输出所有符合要求的卡组。</p>

      <h3>😿 最后</h3>
      <p>如果有好心的贤者酱看出了算法的漏洞 or 有更好的优化方式，还请不吝赐教 🥹</p>
    </div>
  </div>


  <!-- 底栏 -->
  <footer class="bottom-bar text-center">
    <p>© 2025 とある名無し賢者. All rights waived.</p>
  </footer>
  <style>
    .lang-text {
      padding: 1px 4px;
      border-radius: 4px;
      line-height: 1.4em;
    }

    .lang-text.active {
      background-color: #ffa5a1;
    }
  </style>
  <div id="lang-switcher" style="
  position: fixed;
  top: 80px;
  left: 8px;
  z-index: 9999;
  font-size: 14px;
  background: ghostwhite;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 2px 4px;
  user-select: none;
  display: flex;
  flex-direction: column;
  gap: 2px;
  align-items: center;
">
    <span class="lang-text" data-lang="zh" style="cursor: pointer;">🇨🇳</span>
    <span class="lang-text" data-lang="ja" style="cursor: pointer;">🇯🇵</span>
  </div>
  <script data-goatcounter="https://krkr.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>

<script src="js/themeToggle.js" defer></script>
<script src="js/utils.js" defer></script>
<script src="js/navigation.js" defer></script>
<script src="js/lastUpdate.js" defer></script>
<script src="js/cardManager.js" defer></script>
<script src="js/calc.js" defer></script>
<script src="js/prophecy.js" defer></script>
<script src="js/i18n.js" defer></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</html>